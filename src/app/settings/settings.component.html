<div class="settings-container">
  <div class="header">
    <h1>Settings</h1>
    <p>Manage your app preferences</p>
  </div>

  <div class="settings-sections">
    <!-- Google Drive Sync Section -->
    <div class="settings-section">
      <h2>Google Drive Sync</h2>
      
      <!-- Connection Status -->
      <div class="setting-item">
        <div class="setting-info">
          <h3>Connection Status</h3>
          <p *ngIf="!syncStatus.isAuthenticated" class="status-disconnected">Not connected</p>
          <p *ngIf="syncStatus.isAuthenticated" class="status-connected">Connected to Google Drive</p>
          <p *ngIf="syncStatus.error" class="status-error">{{ syncStatus.error }}</p>
          <p *ngIf="!isGoogleDriveConfigured" class="status-error">Google Drive integration not configured</p>
        </div>
        <button 
          *ngIf="!syncStatus.isAuthenticated" 
          class="connect-button" 
          (click)="connectGoogleDrive()"
          [disabled]="!isGoogleDriveConfigured">
          Connect
        </button>
        <button 
          *ngIf="syncStatus.isAuthenticated" 
          class="disconnect-button" 
          (click)="disconnectGoogleDrive()">
          Disconnect
        </button>
      </div>

      <!-- Auto Sync Toggle -->
      <div class="setting-item" *ngIf="syncStatus.isAuthenticated">
        <div class="setting-info">
          <h3>Auto Sync</h3>
          <p>Automatically upload new photos to Google Drive</p>
        </div>
        <label class="toggle-switch">
          <input 
            type="checkbox" 
            [checked]="syncStatus.isEnabled" 
            (change)="onAutoSyncToggle($event)">
          <span class="toggle-slider"></span>
        </label>
      </div>

      <!-- Sync Status -->
      <div class="setting-item" *ngIf="syncStatus.isAuthenticated">
        <div class="setting-info">
          <h3>Sync Status</h3>
          <p *ngIf="syncStatus.lastSync">Last sync: {{ syncStatus.lastSync | date:'short' }}</p>
          <p *ngIf="!syncStatus.lastSync">Never synced</p>
          <p *ngIf="syncStatus.isSyncing" class="status-syncing">Syncing in progress...</p>
        </div>
      </div>

      <!-- Manual Sync -->
      <div class="setting-item" *ngIf="syncStatus.isAuthenticated">
        <div class="setting-info">
          <h3>Manual Sync</h3>
          <p>Force sync all unsynced photos now</p>
        </div>
        <div class="sync-buttons">
          <button 
            class="sync-button" 
            (click)="forceSync()"
            [disabled]="syncStatus.isSyncing">
            <span *ngIf="!syncStatus.isSyncing">Force Sync</span>
            <span *ngIf="syncStatus.isSyncing">Syncing...</span>
          </button>
          <button 
            class="sync-button" 
            (click)="syncAllPhotos()"
            [disabled]="syncStatus.isSyncing">
            <span *ngIf="!syncStatus.isSyncing">Sync All</span>
            <span *ngIf="syncStatus.isSyncing">Syncing...</span>
          </button>
        </div>
      </div>

      <!-- Google Drive Info -->
      <div class="setting-item" *ngIf="isGoogleDriveConfigured">
        <div class="setting-info">
          <h3>About Google Drive Sync</h3>
          <p>Photos are synced to a "MyDailyFace" folder in your Google Drive</p>
        </div>
      </div>
    </div>

    <!-- Appearance Settings Section -->
    <div class="settings-section">
      <h2>Appearance</h2>
      
      <!-- Theme Selection -->
      <div class="setting-item">
        <div class="setting-info">
          <h3>Theme</h3>
          <p>Choose your preferred app theme</p>
        </div>
        <div class="theme-selector">
          <label class="theme-option">
            <input 
              type="radio" 
              name="theme" 
              value="light" 
              [checked]="currentThemePreference === 'light'"
              (change)="onThemeChange('light')">
            <span class="theme-label">Light</span>
          </label>
          <label class="theme-option">
            <input 
              type="radio" 
              name="theme" 
              value="dark" 
              [checked]="currentThemePreference === 'dark'"
              (change)="onThemeChange('dark')">
            <span class="theme-label">Dark</span>
          </label>
          <label class="theme-option">
            <input 
              type="radio" 
              name="theme" 
              value="system" 
              [checked]="currentThemePreference === 'system'"
              (change)="onThemeChange('system')">
            <span class="theme-label">System</span>
          </label>
        </div>
      </div>
      
      <!-- Face Alignment Overlay Opacity -->
      <div class="setting-item">
        <div class="setting-info">
          <h3>Face Alignment Overlay Opacity</h3>
          <p>Adjust transparency of face alignment guide ({{ (overlayOpacity * 100).toFixed(0) }}%)</p>
        </div>
      </div>
      <div class="setting-item">
        <div class="opacity-slider-container">
          <input 
            type="range" 
            min="0.1" 
            max="1" 
            step="0.1" 
            [value]="overlayOpacity"
            (input)="onOverlayOpacityChange($event)"
            class="opacity-slider">
          <div class="opacity-labels">
            <span>10%</span>
            <span>50%</span>
            <span>100%</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Storage Section -->
    <div class="settings-section">
      <h2>Storage</h2>
      <div class="setting-item">
        <div class="setting-info">
          <h3>Photos Stored</h3>
          <p>{{ photoCount }} photos saved locally</p>
        </div>
      </div>
      <div class="setting-item">
        <div class="setting-info">
          <h3>Clear All Photos</h3>
          <p>Remove all stored photos from device</p>
        </div>
        <button class="danger-button" (click)="clearAllPhotos()">
          Clear All
        </button>
      </div>
    </div>

    <!-- App Installation Section -->
    <div class="settings-section">
      <h2>App Installation</h2>
      
      <!-- Installation Status -->
      <div class="setting-item" *ngIf="isInstalled">
        <div class="setting-info">
          <h3>Installation Status</h3>
          <p class="status-connected">âœ… App is installed on your device</p>
        </div>
      </div>

      <!-- Install Button -->
      <div class="setting-item" *ngIf="!isInstalled">
        <div class="setting-info">
          <h3>Install App</h3>
          <p>Add MyDailyFace to your home screen for easy access</p>
        </div>
        <button class="install-button" (click)="installApp()">
          <span *ngIf="canInstall">Install App</span>
          <span *ngIf="!canInstall">Show Instructions</span>
        </button>
      </div>

      <!-- Manual Installation Instructions -->
      <div class="setting-item" *ngIf="!isInstalled">
        <div class="setting-info">
          <h3>Manual Installation</h3>
          <p>Need help installing the app? View step-by-step instructions</p>
        </div>
        <button class="secondary-button" (click)="toggleInstallInstructions()">
          <span *ngIf="!showInstallInstructions">Show Instructions</span>
          <span *ngIf="showInstallInstructions">Hide Instructions</span>
        </button>
      </div>

      <!-- Installation Instructions Modal -->
      <div class="install-instructions-overlay" *ngIf="showInstallInstructions" (click)="closeInstallInstructions()">
        <div class="install-instructions-modal" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <h3>Install MyDailyFace</h3>
            <button class="close-button" (click)="closeInstallInstructions()">Ã—</button>
          </div>
          <div class="modal-content">
            <h4>{{ installInstructions.platform }}</h4>
            <ol>
              <li *ngFor="let instruction of installInstructions.instructions">{{ instruction }}</li>
            </ol>
            <div class="modal-footer">
              <p><strong>Benefits of installing:</strong></p>
              <ul>
                <li>Faster loading and better performance</li>
                <li>Works offline for taking photos</li>
                <li>Quick access from your home screen</li>
                <li>Full-screen experience without browser bars</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- About Section -->
    <div class="settings-section">
      <h2>About</h2>
      <div class="setting-item">
        <div class="setting-info">
          <h3>Version</h3>
          <p (click)="onVersionTap()" style="cursor: pointer;">MyDailyFace v1.0.0</p>
        </div>
      </div>
      <div class="setting-item">
        <div class="setting-info">
          <h3>Privacy</h3>
          <p>Photos stored locally and optionally synced to your Google Drive</p>
        </div>
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h3>Legal</h3>
          <div class="legal-links">
            <a routerLink="/privacy" class="legal-link">Privacy Policy</a>
            <span class="legal-separator">â€¢</span>
            <a routerLink="/terms" class="legal-link">Terms of Service</a>
          </div>
        </div>
      </div>
    </div>

    <!-- Hidden Testing Section -->
    <div class="settings-section" *ngIf="showTestingFeatures">
      <h2 style="color: #ff9500;">ðŸ§ª Testing Features</h2>
      
      <div class="setting-item">
        <div class="setting-info">
          <h3>Generate Test Data</h3>
          <p>Create 2 years of daily face photos for testing the Play feature</p>
        </div>
        <button 
          class="test-button" 
          (click)="generateTestData()"
          [disabled]="isGeneratingTestData">
          <span *ngIf="!isGeneratingTestData">Generate</span>
          <span *ngIf="isGeneratingTestData">Generating...</span>
        </button>
      </div>

      <div class="setting-item">
        <div class="setting-info">
          <h3>Clear Test Data</h3>
          <p>Remove all test-generated photos (keeps real photos)</p>
        </div>
        <button class="danger-button" (click)="clearTestData()">
          Clear Tests
        </button>
      </div>

      <div class="setting-item">
        <div class="setting-info">
          <h3>Animation Speed</h3>
          <p>Slow down animations for debugging (Current: {{ getAnimationSpeedText() }})</p>
        </div>
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h3>Speed Options</h3>
          <p>Choose animation slowdown multiplier</p>
        </div>
        <div class="speed-controls">
          <button class="speed-button" 
                  [class.active]="currentAnimationSpeed === 1"
                  (click)="setAnimationSpeed(1)">
            Normal
          </button>
          <button class="speed-button" 
                  [class.active]="currentAnimationSpeed === 2"
                  (click)="setAnimationSpeed(2)">
            2x
          </button>
          <button class="speed-button" 
                  [class.active]="currentAnimationSpeed === 5"
                  (click)="setAnimationSpeed(5)">
            5x
          </button>
          <button class="speed-button" 
                  [class.active]="currentAnimationSpeed === 10"
                  (click)="setAnimationSpeed(10)">
            10x
          </button>
        </div>
      </div>

      <div class="setting-item">
        <div class="setting-info">
          <h3>Hide Testing</h3>
          <p>Hide these testing features</p>
        </div>
        <button class="cancel-button" (click)="hideTestingFeatures()">
          Hide
        </button>
      </div>
    </div>
  </div>
</div>